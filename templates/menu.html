{% extends "_base.html" %}
{% from "_macros.html" import nav_bar, header, message_flashing %}
{% from "_macros_js.html" import google_maps_script %}

<!-- HEAD -->
{% block title %}
  <title>Online Menu: {{ restaurant.name }}</title>
{% endblock %}

{% block description %}
    <meta description="still i'll have to fill this up">
{% endblock%}


<!-- BODY -->
{% block content %}

  {{ nav_bar({"Info":"#restaurant-info", "Menu":"#menu", "Comments":"#comments"}) }}

  {{ header(main_page=False, restaurant=restaurant) }}

  {{ message_flashing() }}

    <!-- Restaurant info section -->
    <section class="bg-white" id="restaurant-info">
      <div class="container item">
        <div class="row">
          <div class="col-lg-10 text-left">

            <h1 class="section-heading">{{ restaurant.name }}</h1>
            <h2 class="section-subheading text-muted">Lorem ipsum dolor sit amet consectetur.</h2>

          </div>

          <div class="col-lg-2 text-right">

            <a class="pseudo-btn" href="{{url_for('editRestaurant', restaurant_id=restaurant.id)}}">Edit restaurant</a>
            <a class="pseudo-btn" href="{{url_for('deleteRestaurant', restaurant_id=restaurant.id)}}">Delete restaurant</a>

          </div>
        </div>

        <div class="row">
          <div class="col-lg-12 text-left">
            <p class="text-muted" id="restaurant-description">{{restaurant.description}}</p>
          </div>
        </div>

      </div>
    </section>



    <!-- Restaurant location section -->
    <section class="bg-white half-padding" id="restaurant-location">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 text-left">

            <div id="map"></div>

          </div>
          </div>
        </div>
    </section>




    <!-- Menu section -->
    <section class="bg-white shadow-sm" id="menu">
      <div class="container item">
        <div class="row">
          <div class="col-lg-8 text-left">
            <h3 class="section-heading">Menu:</h3>
          </div>
          <div class="col-lg-4 text-right">
            <a class="pseudo-btn" href = '{{url_for('newMenuItem', restaurant_id = restaurant.id) }}'>Create New Item</a>
          </div>
        </div>
      </div>
    </section>

    <!-- Menu Items section -->
    <section class="bg-light micro-padding" id="menu-items">
    {% for i in menu_items %}
    <!-- <section class="bg-light no-padding"> -->

      <div class="container item menu-item rounded shadow-sm">
        
        <div class="row">
          <div class="col-lg-8 text-left">
            <h4>{{ i.name }}</h4>
          </div>
          <div class="col-lg-4 text-right">
            <p>{{ i.price }}</p>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-12 text-left">
            
            <p><small>{{ i.course }}</small></p>
            <p class="text-muted">{{ i.description }}</p> 

          </div>
        </div>

        <div class="row" id="menu-item-buttons">
          <div class="col-lg-8 text-left">
            <a class="pseudo-btn" href='{{ url_for('editMenuItem', restaurant_id = restaurant.id, item_id = i.id ) }}'>Edit</a>
            <a class="pseudo-btn" href='{{ url_for('deleteMenuItem', restaurant_id = restaurant.id, item_id = i.id ) }}'>Delete</a>
          </div>
          <div class="col-lg-4 text-right align-middle">
            <a class="btn btn-primary">Add to cart</a>
          </div>
        </div>

      </div>
    <!-- </section> -->

    {% endfor %}
    </section>

    <!-- Comments section -->
    <section class="bg-white" id="comments">

      <div class="container item">
        <div class="row">
          <div class="col-lg-12 text-left">
            <h3 class="section-heading">Comments:</h3>
          </div>
        </div>
      </div>

      {% if posts %}
        {% for post in posts %}
        <div class="container item">
          <div class="row">
            <div class="col-lg-12 text-left">
              <hr>
              <h6>{{post.user.email}}</h6>
              <p class="text-muted"><small>Data dodania: {{post.posted_at.strftime('%Y-%m-%d %H:%m')}}</small></p>

              <div class="star-rating">
                <span class="star-label text-muted">Rating: </span>
                <span class="fa fa-star-o" data-rating="1" post-rating="3.5"></span>
                <span class="fa fa-star-o" data-rating="2" post-rating="3.5"></span>
                <span class="fa fa-star-o" data-rating="3" post-rating="3.5"></span>
                <span class="fa fa-star-o" data-rating="4" post-rating="3.5"></span>
                <span class="fa fa-star-o" data-rating="5" post-rating="3.5"></span>
                <span class="star-label text-muted">- 4.5</span>
              </div>

              <p class="text-muted">{{post.content}}</p> 
            </div>
          </div>
        </div>
        {% endfor %} 
      {% else %}
        <div class="container item">
          <div class="row">
            <div class="col-lg-12 text-center">
              <hr>
              <br>
              <h6 class="text-muted">Theres are no posts yet.<br>Be the first one to add a review...</h6>
            </div>
          </div>
        </div>
      {% endif %}


      <div class="container item" id="add-a-comment">
        <div class="row">
          <div class="col-lg-12 text-left">
            <hr>

            <br>
            <h5>Add a comment:</h5>
            <br>

            <form id="contactForm" action="{{url_for('restaurantMenu', restaurant_id=restaurant.id)}}" method = 'POST'  novalidate="novalidate">
              <div class="form-group">
                <input name="user_name" class="form-control" id="user-name" type="text" placeholder="Your Name *" required="required" data-validation-required-message="Please enter your name.">
                <p class="help-block text-danger"></p>
              </div>
              <div class="form-group">
                <textarea name="message" class="form-control" id="message" placeholder="Your Message *" required="required" data-validation-required-message="Please enter a message."></textarea>
                <p class="help-block text-danger"></p>
              </div>
              <div class="form-group text-center">
                <button class="btn btn-xl btn-block btn-primary" type="submit">Send Message</button>
              </div>
            </form>
          </div>
        </div>
      </div>

    </section>

{% endblock %}

{% block scripts %}
  {{ google_maps_script() }}

  <script type="text/javascript">
  
  var $star_rating = $('.star-rating .fa');


  $(document).ready(function() {
    $star_rating.each(function() {
      var data_rating = parseFloat($(this).attr( "data-rating" ));
      var post_rating = parseFloat($(this).attr( "post-rating" ));

      if (data_rating <= post_rating) {
        $(this).removeClass('fa-star-o').addClass('fa-star');
      }
      else if ((data_rating - 1) < post_rating) {
        $(this).removeClass('fa-star-o').addClass('fa-star-half-o');
      }

    });

  });

  // $(document).ready(function() {
  //   $star_rating.each(function() {
  //     console.log($(this).attr( "data-rating" ));
  //   });
  // });


// var $star_rating = $('.star-rating .fa');

// var SetRatingStar = function() {
//   return $star_rating.each(function() {
//     if (parseInt($star_rating.siblings('input.rating-value').val()) >= parseInt($(this).data('rating'))) {
//       return $(this).removeClass('fa-star-o').addClass('fa-star');
//     } else {
//       return $(this).removeClass('fa-star').removeClass('text-muted').addClass('fa-star-o');
//     }
//   });
// };

// $star_rating.on('click', function() {
//   $star_rating.siblings('input.rating-value').val($(this).data('rating'));
//   return SetRatingStar();
// });

// SetRatingStar();
// $(document).ready(function() {

// });


  </script>
{% endblock%}